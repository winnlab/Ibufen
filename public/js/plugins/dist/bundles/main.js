/*modules/main/main*/
define("modules/main/main",["controller"],function(t){"use strict";t&&t.__esModule||(t={"default":t});var i=t["default"],e=i.extend({defaults:{}},{bindings:function(){var t=this;this.element.on("custom_focus",function(){return t.element.hasClass("active")?void 0:!1})},variables:function(){this.base_url=window.location.protocol+"//"+window.location.host,this.mapLatLng=new google.maps.LatLng(50.433,30.517),this.fixed_topper=$("#fixed_topper"),this.window=$(window),this.main_container=$("#main_container"),this.location_input=this.element.find("#location_input"),this.topper_container=this.element.find(".topper_container"),this.video_container=this.element.find(".video_container"),this.dragon_container=this.element.find(".dragon_container"),this.safety_container=this.element.find(".safety_container"),this.europe_container=this.element.find(".europe_container"),this.map_container=this.element.find(".map_container"),this.player=this.video_container.find(".player"),this.instruction_button=this.element.find("button.instruction"),this.instruction_container=this.element.find(".instruction_container"),this.instruction_items=this.instruction_container.find(".item"),this.up_arrow=this.element.find(".up_arrow"),this.location_container=this.element.find(".location_container"),this.active="active",this.referrer=decodeURI(document.location.href),this.scrolled_first_screen=!1},plugins:function(){this.init_map()},sizes:function(){this.window_height=this.window.height(),this.topper_container.height(this.window_height),this.topper_container_height=this.topper_container.height(),this.video_container_height=this.video_container.height(),this.dragon_container_height=this.dragon_container.height(),this.safety_container_height=this.safety_container.height(),this.europe_container_height=this.europe_container.height(),this.map_container_height=this.map_container.height(),this.fixed_topper_height=this.fixed_topper.height(),this.video_bottom_offset=this.topper_container_height+this.player.position().top+this.player.height()|0,(this.main_container.hasClass("mini")||this.main_container.hasClass("tiny"))&&this.up_arrow.hide()},init_map:function(){var t={center:this.mapLatLng,zoom:12,scrollwheel:!1};this.map=new google.maps.Map(document.getElementById("map"),t),this.get_locations()},get_locations:function(){if(!navigator.geolocation)return console.error("Geolocation is not supported by this browser.");var t=this,i=null,e={enableHighAccuracy:!0,timeout:1e3,maximumAge:0};navigator.geolocation.getCurrentPosition(function(e){i={lat:e.coords.latitude,lng:e.coords.longitude},t.location_request(i)},function(i){t.show_location_input(),console.error(i)},e)},show_location_input:function(){this.autocomplete=new google.maps.places.Autocomplete(document.getElementById("location_input"),{types:["geocode"]}),this.location_container.addClass(this.active)},location_request:function(t){var i=this;can.ajax({type:"POST",url:"/pharmacy_near",data:t,success:function(t){i.success_location_request(t.data)},error:function(t,e,n){i.show_location_input(),console.error(n)}})},success_location_request:function(t){var i,e,n,o=this,s=new google.maps.LatLngBounds;for(t.lng&&t.lat&&this.map.setCenter(new google.maps.LatLng(t.lat,t.lng)),i=t.pharmacy.length;i--;)!function(i){n=t.pharmacy[i],e=new google.maps.LatLng(n.loc[1],n.loc[0]),s.extend(e);var a=new google.maps.Marker({position:e,map:o.map,icon:o.base_url+"/img/user/640/marker.png"}),r=new google.maps.InfoWindow({content:'<div style="overflow:hidden;line-height:1.35;width:auto;min-width:200px;height:auto;min-height:80px;"><div>'+n.name+"</div><div>"+n.city+"</div><div>"+n.address+"</div></div>"});google.maps.event.addListener(a,"click",function(){r.open(o.map,a)})}(i);s.length&&this.map.fitBounds(s),this.location_container.removeClass(this.active)},after_init:function(){this.check_up_arrow(this.window),this.instruction_container.hide(),this.instruction_items.filter(":not(.active)").find(".text").hide()},".topper_container .buy_button click":function(){ga("set","page",this.referrer),ga("send","event","NearestPharmacy","Click"),this.scroll_to_map()},scroll_to_map:function(){var t=this.topper_container_height+this.video_container_height+this.dragon_container_height+this.safety_container_height+this.europe_container_height-this.fixed_topper_height;$("html, body").stop().animate({scrollTop:t},1e3)},"button.instruction click":function(){ga("set","page",this.referrer),ga("send","event","Instruction","Click");var t="slideUp",i="block"==this.instruction_container.css("display"),e=this.topper_container_height+this.video_container_height+this.dragon_container_height+this.safety_container_height+this.europe_container_height+this.map_container_height-this.fixed_topper_height;i||(t="slideDown",$("html, body").stop().animate({scrollTop:e},500)),this.instruction_container.stop(!0,!1)[t](300)},".instruction_container .slide_up click":function(){this.instruction_container.stop(!0,!1).slideUp(300)},".instruction_container .item click":function(t){var i=t.find(".text"),e="slideDown";t.hasClass(this.active)&&(e="slideUp"),i.stop(!0,!1)[e](300),t.toggleClass(this.active)},".up_arrow click":function(){$("html, body").scrollTop(0),ga("set","page",this.referrer),ga("send","event","UpArrow","Click")},".map_container .find click":function(){ga("set","page",this.referrer),ga("send","event","Find","Click");var t={address:this.location_input.val()};this.location_request(t)},"{window} scroll":function(t,i){this.element.hasClass(this.active)&&(this.check_up_arrow(this.window,i),this.check_first_screen(this.window,i),this.check_video_module(this.window,i))},check_video_module:function(t){var i=t.scrollTop()+this.window_height,e="";i>this.video_bottom_offset&&(e="video"),can.route.attr({module:e},!0)},check_first_screen:function(t){if(!this.scrolled_first_screen){var i=t.scrollTop();i+this.window_height>this.topper_container_height&&(ga("set","page",this.referrer),ga("send","event","FirstScreen","Scrolled"),this.scrolled_first_screen=!0)}},check_up_arrow:function(t){if(this.main_container.hasClass("mini")||this.main_container.hasClass("tiny"))return void this.up_arrow.hide();var i=t.scrollTop(),e=this.topper_container_height+this.video_container_height-this.window_height,n="show";e>i&&(n="hide"),this.up_arrow[n]()}});return{get default(){return e},__esModule:!0}});
